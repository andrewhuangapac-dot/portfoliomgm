<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Stock Portfolio (AI Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f1f5f9; color: #334155; }
        
        /* ÁæéËÇ°ÊÖ£‰æãÔºöÁ∂†Êº≤Á¥ÖË∑å (Ëã•ÊÇ®ÁøíÊÖ£Á¥ÖÊº≤Á∂†Ë∑åÔºåË´ãÂ∞á‰∏ãÊñπÈ°èËâ≤‰ª£Á¢º‰∫íÊèõ) */
        .text-up { color: #16a34a; }   /* Green for Up */
        .text-down { color: #dc2626; } /* Red for Down */
        
        .loader { border: 3px solid #e2e8f0; border-radius: 50%; border-top: 3px solid #2563eb; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* AI Markdown Style */
        .prose h1, .prose h2, .prose h3 { font-weight: 700; color: #1e293b; margin-top: 1em; margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.3em; }
        .prose p { margin-bottom: 0.8em; line-height: 1.6; }
        .prose strong { color: #0f172a; font-weight: 700; }

        .ai-glow { box-shadow: 0 0 20px rgba(37, 99, 235, 0.3); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); } 100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); } }
    </style>
</head>
<body>

<div id="app" class="min-h-screen p-4 md:p-8 max-w-7xl mx-auto">
    
    <header class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <h1 class="text-2xl font-extrabold text-slate-900 flex items-center gap-2 tracking-tight">
                US Stock Portfolio
                <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-md font-bold tracking-wide flex items-center gap-1 shadow-sm">
                    AI PRO
                </span>
            </h1>
            <p class="text-slate-500 text-sm font-medium">Wall St. News ‚Ä¢ Reddit Sentiment ‚Ä¢ Gemini Analysis</p>
        </div>
        <div class="flex gap-2">
            <button @click="resetPassword" class="px-3 py-2 text-xs text-slate-400 hover:text-slate-600 underline font-medium">Reset Key</button>
            <button @click="fetchData" class="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg shadow-sm hover:bg-slate-50 text-sm font-bold transition flex items-center gap-2">
                <span v-if="isLoading" class="loader w-4 h-4 border-slate-400 border-t-transparent"></span>
                <span>{{ isLoading ? 'Syncing...' : 'üîÑ Sync Data' }}</span>
            </button>
            <button @click="saveData" class="px-4 py-2 bg-slate-900 text-white rounded-lg shadow-md hover:bg-slate-800 text-sm font-bold transition">üíæ Save Changes</button>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">Buying Power (Cash)</h3>
            <div class="flex justify-between items-end mt-2">
                <p class="text-2xl font-bold text-slate-800">${{ formatCurrency(dashboard.cash) }}</p>
                <button @click="showCashModal = true" class="text-xs text-blue-600 hover:bg-blue-50 px-2 py-1 rounded transition font-medium">Manage</button>
            </div>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">Cost Basis</h3>
            <p class="text-2xl font-bold text-slate-800 mt-2">${{ formatCurrency(dashboard.investedAmount) }}</p>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">Realized P&L</h3>
            <p class="text-2xl font-bold mt-2" :class="dashboard.totalRealizedPnL >= 0 ? 'text-up' : 'text-down'">
                {{ dashboard.totalRealizedPnL >= 0 ? '+' : '' }}${{ formatCurrency(dashboard.totalRealizedPnL) }}
            </p>
        </div>
        <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
            <h3 class="text-slate-400 text-xs font-bold uppercase tracking-wider">Total Net Worth</h3>
            <p class="text-2xl font-bold text-slate-800 mt-2">${{ formatCurrency(dashboard.cash + dashboard.investedAmount) }}</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-6">
            
            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-sm font-bold text-slate-700 mb-4 uppercase tracking-wide">New Trade Entry</h2>
                <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                    <div class="col-span-2 md:col-span-1"><input type="date" v-model="form.date" class="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-blue-500 outline-none"></div>
                    <div class="col-span-2 md:col-span-1"><select v-model="form.type" class="w-full border border-slate-300 rounded-lg p-2.5 text-sm font-medium"><option value="buy">BUY</option><option value="sell">SELL</option></select></div>
                    <div class="col-span-2 md:col-span-1"><input type="text" v-model="form.symbol" placeholder="Symbol (e.g. NVDA)" class="w-full border border-slate-300 rounded-lg p-2.5 text-sm uppercase font-bold placeholder-slate-400"></div>
                    <div class="col-span-1"><input type="number" step="0.01" v-model.number="form.price" placeholder="Price ($)" class="w-full border border-slate-300 rounded-lg p-2.5 text-sm"></div>
                    <div class="col-span-1"><input type="number" v-model.number="form.shares" placeholder="Shares" class="w-full border border-slate-300 rounded-lg p-2.5 text-sm"></div>
                    <div class="col-span-2 md:col-span-1"><button @click="addTransaction" class="w-full bg-blue-600 text-white p-2.5 rounded-lg hover:bg-blue-700 text-sm font-bold transition shadow-sm">Add Trade</button></div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                    <h2 class="font-bold text-slate-700 text-sm uppercase tracking-wide">Current Positions</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-semibold">
                            <tr><th class="p-3">Symbol</th><th class="p-3 text-right">Shares</th><th class="p-3 text-right">Avg Cost</th><th class="p-3 text-center">Action</th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr v-for="(holding, symbol) in dashboard.holdings" :key="symbol" v-show="holding.shares > 0" class="hover:bg-slate-50 transition-colors">
                                <td class="p-3 font-bold text-slate-800">{{ symbol }}</td>
                                <td class="p-3 text-right font-medium">{{ holding.shares }}</td>
                                <td class="p-3 text-right text-slate-500">${{ formatCurrency(holding.avgCost, 2) }}</td>
                                <td class="p-3 text-center">
                                    <button @click="openAIModal(symbol)" class="group bg-white border border-blue-200 text-blue-600 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-blue-50 hover:border-blue-300 transition flex items-center gap-1 mx-auto shadow-sm">
                                        <span class="group-hover:scale-110 transition-transform">‚ö°</span> AI Insight
                                    </button>
                                </td>
                            </tr>
                            <tr v-if="Object.keys(dashboard.holdings).length === 0"><td colspan="4" class="p-8 text-center text-slate-400 italic">No open positions. Time to invest?</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

             <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="p-4 border-b border-slate-100 bg-slate-50"><h2 class="font-bold text-slate-700 text-sm uppercase tracking-wide">Trade History</h2></div>
                <div class="overflow-x-auto max-h-96 overflow-y-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-semibold sticky top-0">
                            <tr><th class="p-3">Date</th><th class="p-3">Sym</th><th class="p-3">Type</th><th class="p-3 text-right">Price</th><th class="p-3 text-right">Shares</th><th class="p-3 text-right">P&L</th><th class="p-3"></th></tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr v-for="t in sortedTransactions" :key="t.id" class="hover:bg-slate-50 transition-colors">
                                <td class="p-3 text-slate-500 text-xs">{{ t.date }}</td>
                                <td class="p-3 font-bold text-slate-700">{{ t.symbol }}</td>
                                <td class="p-3"><span :class="t.type==='buy'?'bg-blue-50 text-blue-700 border-blue-100':'bg-amber-50 text-amber-700 border-amber-100'" class="px-2 py-0.5 rounded text-xs border font-bold uppercase">{{ t.type }}</span></td>
                                <td class="p-3 text-right font-medium">${{ formatCurrency(t.price) }}</td>
                                <td class="p-3 text-right font-medium">{{ t.shares }}</td>
                                <td class="p-3 text-right font-bold"><span v-if="t.type==='sell'" :class="t.realizedPnL>=0?'text-up':'text-down'">{{ t.realizedPnL>=0?'+':'' }}${{ formatCurrency(t.realizedPnL, 0) }}</span><span v-else class="text-slate-300">-</span></td>
                                <td class="p-3 text-center"><button @click="removeTransaction(t.id)" class="text-slate-300 hover:text-red-500 transition font-bold">√ó</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="space-y-6">
            <div class="bg-white rounded-xl shadow-sm p-5 border border-slate-200">
                <h2 class="font-bold text-slate-700 border-b border-slate-100 pb-2 mb-2 text-sm uppercase tracking-wide">Monthly P&L</h2>
                <div v-for="(stat, month) in dashboard.monthlyStats" :key="month" class="flex justify-between py-2 border-b border-slate-50 last:border-0 text-sm">
                    <span class="text-slate-600 font-medium">{{ month }}</span>
                    <span :class="stat.pnl >= 0 ? 'text-up' : 'text-down'" class="font-bold">{{ stat.pnl >= 0 ? '+' : '' }}${{ formatCurrency(stat.pnl, 0) }}</span>
                </div>
                <div v-if="Object.keys(dashboard.monthlyStats).length === 0" class="text-center text-slate-400 py-4 text-xs italic">No realized gains yet.</div>
            </div>
            
            <div class="bg-white rounded-xl shadow-sm p-5 border border-slate-200">
                <div class="flex justify-between items-center border-b border-slate-100 pb-2 mb-2">
                    <h2 class="font-bold text-slate-700 text-sm uppercase tracking-wide">Cash Flow Log</h2>
                </div>
                <div class="max-h-64 overflow-y-auto space-y-2">
                    <div v-for="adj in sortedAdjustments" :key="adj.id" class="flex justify-between text-sm py-1 border-b border-slate-50 last:border-0">
                        <div class="flex flex-col">
                            <span class="text-slate-400 text-xs">{{ adj.date }}</span>
                            <span class="text-slate-700 font-medium">{{ adj.note }}</span>
                        </div>
                        <span :class="adj.amount>=0?'text-blue-600':'text-orange-600'" class="font-bold self-center">{{ adj.amount>=0?'+':''}}${{ formatCurrency(adj.amount, 0) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showAIModal" class="fixed inset-0 bg-slate-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[85vh] shadow-2xl flex flex-col overflow-hidden relative border border-slate-200">
            <div class="p-5 bg-gradient-to-r from-slate-800 to-slate-900 text-white flex justify-between items-center">
                <h3 class="text-lg font-bold flex items-center gap-2">
                    <span class="text-blue-400">ü§ñ</span> AI Analyst - {{ selectedSymbol }}
                </h3>
                <button @click="showAIModal = false" class="text-slate-400 hover:text-white text-2xl transition">&times;</button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 bg-slate-50">
                
                <div v-if="aiLoading" class="flex flex-col items-center justify-center py-12 space-y-6">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center ai-glow border border-blue-100">
                        <div class="loader"></div>
                    </div>
                    <div class="text-center">
                        <p class="text-slate-800 font-bold text-lg">Analyzing Market Data...</p>
                        <p class="text-slate-500 text-sm mt-1">Scanning Wall St. News & Reddit Sentiment</p>
                    </div>
                </div>

                <div v-else>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-blue-100 mb-6 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-2 opacity-10 pointer-events-none">
                            <svg class="w-24 h-24 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
                        </div>
                        <div class="flex items-center gap-2 mb-4">
                            <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs font-bold border border-blue-200">GEMINI 1.5 PRO</span>
                            <span class="text-slate-400 text-xs font-medium">Updated just now</span>
                        </div>
                        <div class="prose prose-sm max-w-none text-slate-700" v-html="aiContentParsed"></div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <a :href="`https://finviz.com/quote.ashx?t=${selectedSymbol}`" target="_blank" class="flex items-center justify-center py-2.5 bg-slate-800 text-white rounded-lg text-xs font-bold hover:bg-slate-900 transition shadow-sm">Finviz Charts</a>
                        <a :href="`https://seekingalpha.com/symbol/${selectedSymbol}`" target="_blank" class="flex items-center justify-center py-2.5 bg-orange-600 text-white rounded-lg text-xs font-bold hover:bg-orange-700 transition shadow-sm">Seeking Alpha</a>
                        <a :href="`https://finance.yahoo.com/quote/${selectedSymbol}`" target="_blank" class="flex items-center justify-center py-2.5 bg-purple-600 text-white rounded-lg text-xs font-bold hover:bg-purple-700 transition shadow-sm">Yahoo Finance</a>
                        <a :href="`https://www.google.com/search?q=${selectedSymbol}+stock+news`" target="_blank" class="flex items-center justify-center py-2.5 bg-blue-50 text-blue-700 border border-blue-200 rounded-lg text-xs font-bold hover:bg-blue-100 transition shadow-sm">Google News</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div v-if="showCashModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg w-80 shadow-xl border border-slate-100">
            <h3 class="font-bold mb-4 text-slate-800 uppercase text-sm tracking-wide">Adjust Cash Balance</h3>
            <input type="date" v-model="cashForm.date" class="w-full border rounded-lg p-2.5 mb-3 text-sm">
            <input type="number" v-model.number="cashForm.amount" class="w-full border rounded-lg p-2.5 mb-3 text-sm" placeholder="Amount (Negative for Withdrawal)">
            <input type="text" v-model="cashForm.note" class="w-full border rounded-lg p-2.5 mb-5 text-sm" placeholder="Note (e.g. Deposit)">
            <div class="flex gap-2"><button @click="addCashAdjustment" class="flex-1 bg-blue-600 text-white py-2.5 rounded-lg text-sm font-bold hover:bg-blue-700">Confirm</button><button @click="showCashModal = false" class="flex-1 bg-slate-100 text-slate-600 py-2.5 rounded-lg text-sm font-bold hover:bg-slate-200">Cancel</button></div>
        </div>
    </div>

</div>

<script>
    const { createApp, reactive, computed, onMounted, ref } = Vue;

    // ==========================================
    // üî¥ Ë®≠ÂÆöÂçÄ (Ë´ãÂãôÂøÖÂ°´ÂõûÊÇ®ÁöÑÁ∂≤ÂùÄ)
    // ==========================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbxPKceeNt02qIcioYzq7g-xv81ujcmMCD3PnqqzGS_AZSf61knL6zrPDIf_I_0Cw7Qs/exec'; 
    // ==========================================

    createApp({
        setup() {
            const transactions = ref([]);
            const cashAdjustments = ref([]);
            const showCashModal = ref(false);
            const isLoading = ref(false);
            const password = ref(localStorage.getItem('portfolio_password') || '');
            const showAIModal = ref(false);
            const aiLoading = ref(false);
            const selectedSymbol = ref('');
            const aiContent = ref('');
            const form = reactive({ date: new Date().toISOString().split('T')[0], type: 'buy', symbol: '', price: '', shares: '' });
            const cashForm = reactive({ date: new Date().toISOString().split('T')[0], amount: '', note: '' });

            onMounted(() => { if (password.value) fetchData(); });

            const checkPassword = () => {
                if (!password.value) {
                    const input = prompt('Enter Access Password:');
                    if (input) {
                        password.value = input;
                        localStorage.setItem('portfolio_password', input);
                    } else {
                        alert('Password required.');
                        return false;
                    }
                }
                return true;
            };

            const resetPassword = () => {
                localStorage.removeItem('portfolio_password');
                password.value = '';
                alert('Password cleared.');
            };

            const aiContentParsed = computed(() => aiContent.value ? marked.parse(aiContent.value) : '');

            const fetchData = async () => {
                if (!checkPassword()) return;
                if (API_URL === 'YOUR_GOOGLE_SCRIPT_URL') return alert('Please set your API URL in the code!');
                isLoading.value = true;
                try {
                    const res = await fetch(`${API_URL}?action=read&password=${encodeURIComponent(password.value)}`);
                    const data = await res.json();
                    if (data.status === 'error') throw new Error(data.message);
                    transactions.value = data.transactions || [];
                    cashAdjustments.value = data.cashAdjustments || [];
                } catch (e) {
                    if(e.message.includes('ÂØÜÁ¢ºÈåØË™§') || e.message.includes('Password')) resetPassword();
                    alert(e.message);
                } finally { isLoading.value = false; }
            };

            const saveData = async () => {
                if (!checkPassword()) return;
                if(!confirm('Save all changes?')) return;
                try {
                    const res = await fetch(`${API_URL}?action=save&password=${encodeURIComponent(password.value)}`, {
                        method: 'POST', body: JSON.stringify({ transactions: transactions.value, cashAdjustments: cashAdjustments.value })
                    });
                    const data = await res.json();
                    if(data.status === 'error') throw new Error(data.message);
                    alert('Saved successfully!');
                } catch (e) { alert('Save failed: ' + e.message); }
            };

            const openAIModal = async (symbol) => {
                if (!checkPassword()) return;
                selectedSymbol.value = symbol;
                showAIModal.value = true;
                aiLoading.value = true;
                aiContent.value = '';
                try {
                    const res = await fetch(`${API_URL}?action=analyze&symbol=${symbol}&password=${encodeURIComponent(password.value)}`);
                    const data = await res.json();
                    if (data.status === 'success') aiContent.value = data.analysis;
                    else aiContent.value = `**Analysis Failed**: ${data.message || 'Unknown error'}`;
                } catch (e) { aiContent.value = `**Connection Error**: ${e.message}`; } finally { aiLoading.value = false; }
            };

            const dashboard = computed(() => {
                let cash = 0, holdings = {}, totalRealizedPnL = 0, investedAmount = 0, monthlyStats = {};
                cashAdjustments.value.forEach(adj => cash += adj.amount);
                const sorted = [...transactions.value].sort((a,b) => new Date(a.date)-new Date(b.date));
                sorted.forEach(t => {
                    const sym = t.symbol.toUpperCase();
                    if(!holdings[sym]) holdings[sym] = {shares:0, totalCost:0, avgCost:0};
                    const amt = t.price * t.shares;
                    if(t.type === 'buy') {
                        cash -= amt; holdings[sym].totalCost += amt; holdings[sym].shares += t.shares;
                        if(holdings[sym].shares>0) holdings[sym].avgCost = holdings[sym].totalCost/holdings[sym].shares;
                    } else {
                        cash += amt; const cost = holdings[sym].avgCost * t.shares; const pnl = amt - cost;
                        totalRealizedPnL += pnl; const m = t.date.substring(0,7);
                        if(!monthlyStats[m]) monthlyStats[m] = {pnl:0}; monthlyStats[m].pnl += pnl;
                        holdings[sym].shares -= t.shares; holdings[sym].totalCost -= cost;
                    }
                });
                for(let s in holdings) if(holdings[s].shares>0) investedAmount += holdings[s].totalCost;
                const sortedMonthly = Object.keys(monthlyStats).sort().reverse().reduce((obj, key) => { obj[key] = monthlyStats[key]; return obj; }, {});
                return { cash, holdings, totalRealizedPnL, investedAmount, monthlyStats: sortedMonthly };
            });

            const sortedTransactions = computed(() => {
                const chronological = [...transactions.value].sort((a,b)=>new Date(a.date)-new Date(b.date));
                const tempHoldings = {};
                const res = chronological.map(t => {
                    const sym = t.symbol.toUpperCase();
                    if(!tempHoldings[sym]) tempHoldings[sym] = {shares:0, totalCost:0, avgCost:0};
                    let realizedPnL = 0; const amt = t.price * t.shares;
                    if(t.type==='buy'){
                         tempHoldings[sym].totalCost+=amt; tempHoldings[sym].shares+=t.shares;
                         if(tempHoldings[sym].shares>0) tempHoldings[sym].avgCost=tempHoldings[sym].totalCost/tempHoldings[sym].shares;
                    } else {
                        const cost = tempHoldings[sym].avgCost * t.shares; realizedPnL = amt - cost;
                        tempHoldings[sym].shares-=t.shares; tempHoldings[sym].totalCost-=cost;
                    }
                    return {...t, realizedPnL};
                });
                return res.sort((a,b)=>new Date(b.date)-new Date(a.date));
            });
            const sortedAdjustments = computed(() => [...cashAdjustments.value].sort((a,b)=>new Date(b.date)-new Date(a.date)));

            const addTransaction = () => {
                if(!form.symbol) return;
                transactions.value.push({ id:Date.now(), date:form.date, type:form.type, symbol:form.symbol.toUpperCase(), price:form.price, shares:form.shares });
                form.symbol=''; form.price=''; form.shares='';
            };
            const removeTransaction = (id) => { if(confirm('Delete trade?')) transactions.value=transactions.value.filter(t=>t.id!==id); };
            const addCashAdjustment = () => { cashAdjustments.value.push({id:Date.now(), date:cashForm.date, amount:cashForm.amount, note:cashForm.note}); showCashModal.value=false; };
            const formatCurrency = (val, d=0) => (val||0).toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d});

            return { API_URL, dashboard, form, cashForm, showCashModal, password, isLoading, transactions, cashAdjustments, sortedTransactions, sortedAdjustments, fetchData, saveData, addTransaction, removeTransaction, addCashAdjustment, formatCurrency, resetPassword, showAIModal, aiLoading, selectedSymbol, aiContentParsed, openAIModal };
        }
    }).mount('#app');
</script>
</body>
</html>
